#Z location of each component (from source)
record(ai, "MCTMSK:Z")
{
    field(DESC, "Fixed mask Z pos")
    field(VAL,  9668)
    field(PINI, "YES")
    field(PREC, "$(PREC=3)")
    field(EGU,  "mm")
}

record(ai, "MCTSLT01:Z")
{
    field(DESC, "Slit A Z pos")
    field(VAL,  10439)
    field(PINI, "YES")
    field(PREC, "$(PREC=3)")
    field(EGU,  "mm")
}

record(ai, "MCTMONO01:Z1")
{
    field(DESC, "DMM layer 1 Z pos")
    field(VAL,  12126)
    field(PINI, "YES")
    field(PREC, "$(PREC=3)")
    field(EGU,  "mm")
}

record(ai, "MCTMONO01:Z2_MIN")
{
    field(DESC, "DMM layer 2 minimum Z pos")
    field(VAL,  12504.4)
    field(PINI, "YES")
    field(PREC, "$(PREC=3)")
    field(EGU,  "mm")
}

record(ai, "MCTMONO01:Z2_MAX")
{
    field(DESC, "DMM layer 2 maximum Z pos")
    field(VAL,  13756)
    field(PINI, "YES")
    field(PREC, "$(PREC=3)")
    field(EGU,  "mm")
}

record(ai, "MCTMONO01:Z2")
{
    field(DESC, "DMM layer 2 Z pos")
    field(VAL,  13756)
    field(PINI, "YES")
    field(PREC, "$(PREC=3)")
    field(EGU,  "mm")
}

record(ai, "MCTMONO01:STRIPE_LEN")
{
    field(DESC, "DMM multilayer stripe length")
    field(VAL,  "330")
    field(PINI, "YES")
    field(PREC, "2")
    field(EGU,  "mm")
}

record(ai, "MCTMONO01:STRIPE_WIDTH")
{
    field(DESC, "DMM multilayer stripe width")
    field(VAL,  "22")
    field(PINI, "YES")
    field(PREC, "2")
    field(EGU,  "mm")
}

record(ai, "MCTSLT02:Z")
{
    field(DESC, "Slit B Z pos")
    field(VAL,  14840)
    field(PINI, "YES")
    field(PREC, "$(PREC=3)")
    field(EGU,  "mm")
}

record(ai, "MCTVBM01:Z")
{
    field(DESC, "VBM Z pos")
    field(VAL,  16091)
    field(PINI, "YES")
    field(PREC, "$(PREC=3)")
    field(EGU,  "mm")
}

record(ai, "MCTSLT03:Z")
{
    field(DESC, "Slit C Z pos")
    field(VAL,  18700)
    field(PINI, "YES")
    field(PREC, "$(PREC=3)")
    field(EGU,  "mm")
}

record(ai, "MCTTBL01:Z")
{
    field(DESC, "Table B1 Z pos")
    field(VAL,  22300)
    field(PINI, "YES")
    field(PREC, "$(PREC=3)")
    field(EGU,  "mm")
}

record(ai, "MCTTBL02:Z")
{
    field(DESC, "Table B2 Z pos")
    field(VAL,  26200)
    field(PINI, "YES")
    field(PREC, "$(PREC=3)")
    field(EGU,  "mm")
}

record(ai, "MCTTBL03:Z")
{
    field(DESC, "Table C1 Z pos")
    field(VAL,  29500)
    field(PINI, "YES")
    field(PREC, "$(PREC=3)")
    field(EGU,  "mm")
}

record(ai, "MCTTBL04:Z")
{
    field(DESC, "Table C2 Z pos")
    field(VAL,  33000)
    field(PINI, "YES")
    field(PREC, "$(PREC=3)")
    field(EGU,  "mm")
}

#Fixed mask aperture
record(ai, "MCTMSK01:HSIZE")
{
    field(DESC, "Fixed mask horz. aperture")
    field(VAL,  2)
    field(PINI, "YES")
    field(PREC, "$(PREC=3)")
    field(EGU,  "mrad")
}
record(ai, "MCTMSK01:VSIZE")
{
    field(DESC, "Fixed mask vert. aperture")
    field(VAL,  0.3)
    field(PINI, "YES")
    field(PREC, "$(PREC=3)")
    field(EGU,  "mrad")
}

#Operational mode and other global calculations
record(calc, "MCT:MODE_CALC")
{
    field(DESC, "Calc for ops mode")
    field(INPA, "MCTMONO01:IN_SERVICE CP")
    field(INPB, "MCTVBM01:IN_SERVICE CP")
    field(CALC, "!(A||B)?0:!A&&B?1:A&&!B?2:3")
}

record(mbbi, "MCT:MODE_STS")
{
    field(DESC, "Beamline ops mode")
    field(INP, "MCT:MODE_CALC CP MS")
    field(ZRVL, 0)
    field(ZRST, "White_Beam")
    field(ONVL, 1)
    field(ONST, "Pink_Beam")
    field(TWVL, 2)
    field(TWST, "Mono_No_Mirror")
    field(THVL, 3)
    field(THST, "Mono_Beam")
}

#DMM angular acceptance
record(calc, "MCTMONO01:H_ACCEPT")
{
    field(DESC, "Calc for DMM horiz. acceptance")
    field(EGU,  "mrad")
    #DMM stripe dimension
    field(INPA, "MCTMONO01:STRIPE_WIDTH CP")
    field(INPB, "MCTMONO01:Z2_MAX CP")
    field(INPC, "MCTMONO01:STRIPE_LEN CP")
    field(CALC, "(A/(B+C/2))*1000")
    field(PREC, "$(PREC=3)")
    field(PINI, "YES")
}
record(calc, "MCTMONO01:V_ACCEPT")
{
    field(DESC, "Calc for DMM vert. acceptance")
    field(EGU,  "mrad")
    #DMM stripe dimension
    field(INPA, "MCTMONO01:STRIPE_LEN CP")
    #DMM ML1 Z
    field(INPB, "MCTMONO01:Z1 CP")
    #DMM ML1 Pitch
    field(INPC, "MCTMONO01MOT06 CP")
    field(CALC, "A*SIN(C*D2R)/B*1000")
    field(PREC, "$(PREC=3)")
    field(PINI, "YES")
}

#VBM angular acceptance
record(calc, "MCTVBM01:H_ACCEPT")
{
    field(DESC, "Calc for VBM horiz. acceptance")
    field(EGU,  "mrad")
    #VBM stripe dimension
    field(INPA, 35)
    field(INPB, "MCTVBM01:Z CP")
    field(CALC, "(A/B)*1000")
    field(PREC, "$(PREC=3)")
    field(PINI, "YES")
}

record(calc, "MCTVBM01:V_ACCEPT")
{
    field(DESC, "Calc for VBM vert. acceptance")
    field(EGU,  "mrad")
    #VBM stripe dimension
    field(INPA, 1150)
    field(INPB, "MCTVBM01:Z CP")
    #VBM Pitch  
    field(INPC, "MCTVBM01:PITCH_USER CP")
    field(CALC, "A*SIN(C*D2R)/B*1000")
    field(PREC, "$(PREC=3)")
    field(PINI, "YES")
}

# In-service positions
record(ai, "MCTMONO01:Y1_IN_POS")
{
    field(DESC, "DMM Y1 In-service Pos")
    field(EGU, "mm")
    field(VAL, "0.0")
    field(PREC, "$(PREC=3)")
    field(PINI, "YES")
}

#Parked Positions for out of service
record(ai, "MCTMONO01:Y1_PARK_POS")
{
    field(DESC, "DMM Y1 Park Pos")
    field(EGU, "mm")
    field(VAL, "-10.0")
    field(PREC, "$(PREC=3)")
    field(PINI, "YES")
}

record(ai, "MCTMONO01:Y2_PARK_POS")
{
    field(DESC, "DMM Y2 Park Pos")
    field(EGU, "mm")
    field(VAL, "29.0")
    field(PREC, "$(PREC=3)")
    field(PINI, "YES")
}

record(ai, "MCTMONO01:P1_PARK_POS")
{
    field(DESC, "DMM P1 Park Pos")
    field(EGU, "mrad")
    field(VAL, "0.0")
    field(PREC, "$(PREC=3)")
    field(PINI, "YES")
}

record(ai, "MCTMONO01:P2_PARK_POS")
{
    field(DESC, "DMM P2 Park Pos")
    field(EGU, "mrad")
    field(VAL, "0.0")
    field(PREC, "$(PREC=3)")
    field(PINI, "YES")
}

record(ai, "MCTVBM01:HEIGHT_PARK_POS")
{
    field(DESC, "VBM Height Park Pos")
    field(EGU, "mm")
    field(VAL, "-7.0")
    field(PREC, "$(PREC=3)")
    field(PINI, "YES")
}

record(ai, "MCTVBM01:PITCH_PARK_POS")
{
    field(DESC, "VBM Pitch Park Pos")
    field(EGU, "mrad")
    field(VAL, "0.0")
    field(PREC, "$(PREC=3)")
    field(PINI, "YES")
}
