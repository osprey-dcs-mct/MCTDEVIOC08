record(ai, "$(P)HSIZE_TARGET1") {
    field(DESC, "Tgt gap when DMM and VBM are out")
    field(VAL,  "16.0")

    info(autosaveFields, "VAL")
}

record(calc, "$(P)HSIZE_STATUS1"){
    field(DESC, "Status if DMM and VBM are out")
    field(INPA, "$(P)HSIZE CP")
    field(INPB, "$(P)HSIZE_TARGET1 CP")
    field(INPC, "0.1")
    field(CALC, "A>0&&A<B+C")
}

record(ai, "$(P)HSIZE_TARGET2") {
    field(DESC, "Tgt gap when DMM is in")
    field(VAL,  "12.6")

    info(autosaveFields, "VAL")
}

record(calc, "$(P)HSIZE_STATUS2"){
    field(DESC, "Status if DMM is in")
    field(INPA, "$(P)HSIZE CP")
    field(INPB, "$(P)HSIZE_TARGET2 CP")
    field(INPC, "0.1")
    field(CALC, "A>0&&A<B+C")
}

record(ai, "$(P)HSIZE_TARGET3") {
    field(DESC, "Tgt gap when DMM out and VBM in")
    field(VAL,  "15.0")

    info(autosaveFields, "VAL")
}

record(calc, "$(P)HSIZE_STATUS3"){
    field(DESC, "Status when DMM out and VBM in")
    field(INPA, "$(P)HSIZE CP")
    field(INPB, "$(P)HSIZE_TARGET3 CP")
    field(INPC, "0.1")
    field(CALC, "A>0&&A<B+C")
}

record(calcout, "$(P)HSIZE_STATUS_CALC"){
    field(DESC, "Select calc based on VBM and DMM status")
    field(INPA, "MCTMONO01:IN_SERVICE CP")
    field(INPB, "MCTVBM01:IN_SERVICE CP")
    field(INPC, "$(P)HSIZE_STATUS1 CP")
    field(INPD, "$(P)HSIZE_STATUS2 CP")
    field(INPE, "$(P)HSIZE_STATUS3 CP")
    field(CALC, "!(A||B)?C:(A?D:E)")
    field(OUT,  "$(P)HSIZE_STATUS PP")
}

record(bi, "$(P)HSIZE_STATUS") {
    field(DESC, "X gap status based on DMM and VBM")
    field(ZNAM, "Not in pos.")
    field(ZSV,  "MINOR")
    field(ONAM, "In posn.")
    field(OSV,  "NO_ALARM")
}

record(calc, "$(P)H_ACCEPT") {
    field(DESC, "Horizontal acceptance")
    field(EGU,  "mrad")
    field(PREC, "3")
    field(INPA, "$(P)Z")
    field(INPB, "$(P)HSIZE CP")
    field(CALC, "B/A*1000")
    field(PINI, "YES")
}

record(calc, "$(P)H_ACCEPT_RATIO") {
    field(DESC, "Horiz. acceptance rel. to MSK01")
    field(EGU,  "%")
    field(PREC, "1")
    field(INPA, "MCTMSK01:HSIZE CP")
    field(INPB, "$(P)H_ACCEPT CP")
    field(CALC, "B/A*100")
    field(LOW,  "90")
    field(LSV,  "MINOR")
    field(HIGH, "102")
    field(HSV,  "MINOR")
    field(PINI, "YES")
}
