record(bo, "$(P):OP_MODE"){
    field(DESC, "Change operational mode")
    field(ZNAM, "MANUAL")
    field(ONAM, "AUTO")
    field(VAL, 0)
    field(PINI, "YES")
}

record(ao, "$(P):AUTO_MOVE"){
    field(DESC, "Auto move to calculated pos")
    field(SDIS, "$(P):OP_MODE CP")
    field(DISV, 0)
    field(DOL, "$(P):XGAP_CALC CP")
    field(OMSL, "closed_loop")
    field(FLNK, "$(P):MOVEXGAP.PROC")
    field(TPRO, 1)
}

record(calc, "$(P):XGAP_CALC1"){
    field(DESC, "Calc for white beam mode)
    field(PREC, $(PREC=3))
    field(INPA, "MCTMONO01:IN_SERVICE CP")
    field(INPB, "MCTVBM01:IN_SERVICE CP")
    field(CALC, "!(A||B)? 20.878 :0")
}

record(calc, "$(P):XGAP_CALC2"){
    field(DESC, ""Calc for pink beam mode"")
    field(PREC, $(PREC=3))
    field(INPA, "MCTMONO01:IN_SERVICE CP")
    field(INPB, "MCTVBM01:IN_SERVICE CP")
    field(CALC, "!A&&B? 20.878 :0")
}

record(calc, "$(P):XGAP_CALC3"){
    field(DESC, "Calc for mono no mirror")
    field(PREC, $(PREC=3))
    field(INPA, "MCTMONO01:IN_SERVICE CP")
    field(INPB, "MCTVBM01:IN_SERVICE CP")
    field(CALC, "A&&!B? 18.939 :0")
}

record(calc, "$(P):XGAP_CALC4"){
    field(DESC, "Calc for mono beam")
    field(PREC, $(PREC=3))
    field(INPA, "MCTMONO01:IN_SERVICE CP")
    field(INPB, "MCTVBM01:IN_SERVICE CP")
    field(CALC, "A&&B? 18.939 :0")
}

record(calcout, "$(P):XGAP_CALC"){
    field(DESC, "Calculate slit xgap")
    field(PREC, $(PREC=3))
    field(INPA, "MCTMONO01:IN_SERVICE CP")
    field(INPB, "MCTVBM01:IN_SERVICE CP")
    field(INPC, "$(P):XGAP_CALC1 CP")
    field(INPD, "$(P):XGAP_CALC2 CP")
    field(INPE, "$(P):XGAP_CALC3 CP")
    field(INPF, "$(P):XGAP_CALC4 CP")
    field(CALC, "!(A||B)?C:!A&&B?D:A&&!B?E:A&&B?F:0")
    field(OUT, "$(P):MOVEXGAP")
}

record(dfanout, "$(P):MOVEXGAP"){
    field(OUTA, "$(MOTOR) PP")
}